#! /usr/bin/env python
# -*- coding: utf-8 -*-

# # # # # # # # # # # # # # # # # # # # # # # #
#	TRADUCTORES E INTERPRETADORES CI3725      #
#	Primera entrega del proyecto.             #
#   Lexer para el lenguaje Setlan             #
#	Autores: Carlos Martínez 	- 11-10584    #
#			 Christian Teixeira - 11-11016    #
# # # # # # # # # # # # # # # # # # # # # # # #

import sl_lexer

# main del programa

def getcol(lineas, token):
	aux = 0
	for i in range(token.lineno-1):
		aux = aux + len(lineas[i])
	return str(token.lexpos - aux + 1)

def main(argv  = None):
	import sys
	if(argv is None):
		argv = sys.argv
	if(len(argv) == 1):
		print("ERROR: No se encontró argumento.\nUso: ./setlan [Nombre_Archivo]\nPor favor verifíque que el archivo existe en su directorio y está correctamente escrito.")
		exit(1)

	global error
	error = []
	out = []

	nombreArchivo = argv[1]
	archivo = open(nombreArchivo, "r")
	lineas = archivo.readlines()
	archivo.seek(0)

	contenido = archivo.read()
	lexer = sl_lexer.build_lexer(contenido)

	# Loop para extraer tokens correctos

	while True:
		tok = lexer.token()
		if not tok: break
		out.append(tok)		# Se incluyen en la lista de out

	# Imprimir resultados

	if len(error) == 0:	# Lista de error vacía, se imprimen los tokens correctos
		for t in out:
			if(t.type == "IDENTIFIER" or t.type == "SETSUBSTRACT" or t.type == "GREATERTHAN"):
				print("token " + str(t.type) + "\tvalue (" + str(t.value) + ") at line " + str(t.lineno) + ", column " + getcol(lineas, t))
			else:
				print("token " + str(t.type) + "\t\tvalue (" + str(t.value) + ") at line " + str(t.lineno) + ", column " + getcol(lineas, t))
	else:				# Lista de error no vacía, se imprimen solo los tokens de error encontrados
		for t in error:
			print("Error: Se encontró un caracter inesperado \"" + t.value[0] + "\" en la Línea " + str(t.lineno) + ", Columna " + str(t.lexpos) + ".")

if __name__ == "__main__":
	main()